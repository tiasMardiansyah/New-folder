{% extends "base.html" %} 
{% block title %}List Pemancingan{% endblock %}

{% block page_specified_style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/list_pemancingan/card.css') }}">
{% endblock %}

{% block content %} 

<div class="mt-1 me-md-3 ms-md-3 mb-4 page-title"><b>Pemancingan</b></div>
<div class="me-md-3 ms-md-3 mb-5">
    <div class="d-flex">
        <input type="text" class="form-control me-3" id="cariPemancingan" placeholder="Cari Tempat Pemancingan">
        <button type="button" class="btn theme-button-neutral-custom pe-4 ps-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path></svg>
        </button>
    </div>
</div>
<div id="list-pemancingan" class="me-md-3 ms-md-3">
    <div class="row row-cols-1 row-cols-md-12 row-cols-lg-3 g-4">
        {% for pemancingan in informasi_pemancingan.data %}
        <div class="col">
            <div class="card h-100 shadow pemancingan-card">
                <img src="{{ url_for('static', filename='images/' ~ pemancingan['image_url']) }}" class="card-img-top pemancingan-card-img" alt="...">
                <div class="card-body">
                    <div class="row w-100">
                        <div class="text-white pemancingan-card-title"><b>{{pemancingan['nama']}}</b></div>
                        <div class="text-white pemancingan-card-text mt-1 mb-2">{{pemancingan['alamat']}}</div>

                        {% if pemancingan['biaya_tempat'] is not none %}
                        <div class="col-4 col-md-4 d-flex align-items-center">
                            <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M232,224H208V32h8a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16h8V224H24a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16ZM64,32H192V224H160V184a8,8,0,0,0-8-8H104a8,8,0,0,0-8,8v40H64Zm80,192H112V192h32ZM88,64a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H96A8,8,0,0,1,88,64Zm48,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H144A8,8,0,0,1,136,64ZM88,104a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H96A8,8,0,0,1,88,104Zm48,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H144A8,8,0,0,1,136,104ZM88,144a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H96A8,8,0,0,1,88,144Zm48,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H144A8,8,0,0,1,136,144Z"></path></svg>
                            <span class="text-white price-tag price-formatted">{{pemancingan['biaya_tempat']}}</span>
                        </div>
                        {% endif %}

                        <div class="col-4 col-md-4 d-flex align-items-center">
                            <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M168,76a12,12,0,1,1-12-12A12,12,0,0,1,168,76Zm48.72,67.64c-19.37,34.9-55.44,53.76-107.24,56.1l-22,51.41A8,8,0,0,1,80.1,256l-.51,0a8,8,0,0,1-7.19-5.78L57.6,198.39,5.8,183.56a8,8,0,0,1-1-15.05l51.41-22c2.35-51.78,21.21-87.84,56.09-107.22,24.75-13.74,52.74-15.84,71.88-15.18,18.64.64,36,4.27,38.86,6a8,8,0,0,1,2.83,2.83c1.69,2.85,5.33,20.21,6,38.85C232.55,90.89,230.46,118.89,216.72,143.64Zm-55.18,29a52.11,52.11,0,0,1-33.4-44.78A52.09,52.09,0,0,1,83.37,94.47q-10.45,23.79-11.3,57.59a8,8,0,0,1-4.85,7.17L31.83,174.37l34.45,9.86a8,8,0,0,1,5.49,5.5l9.84,34.44,15.16-35.4a8,8,0,0,1,7.17-4.84Q137.71,183.12,161.54,172.64ZM212.42,43.57c-14.15-3-64.1-11-100.3,14.75a81.21,81.21,0,0,0-16,15.07,36,36,0,0,0,39.35,38.44,8,8,0,0,1,8.73,8.73,36,36,0,0,0,38.47,39.34,80.81,80.81,0,0,0,15-16C223.42,107.73,215.42,57.74,212.42,43.57Z"></path></svg>
                            <span class="text-white price-tag price-formatted-kg">{{pemancingan['biaya_ikan']}}</span>
                        </div>

                        <div class="col-4 col-md-4 d-flex align-items-center">
                            <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M231.87,32.13a27.84,27.84,0,0,0-39.32,0L18.34,206.4a8,8,0,0,0,3.86,13.45A160.67,160.67,0,0,0,58.4,224c32.95,0,65.92-10.2,96.95-30.23,31.76-20.5,50.19-43.82,51-44.81a8,8,0,0,0-.64-10.59L185.32,118l46.55-46.56A27.85,27.85,0,0,0,231.87,32.13ZM189.1,144.44a220.41,220.41,0,0,1-42.86,36.16c-34.43,22.1-69.94,30.92-105.77,26.3L146,101.33Zm31.46-84.3L174,106.7,157.32,90l46.55-46.56a11.8,11.8,0,0,1,16.69,16.69Z"></path></svg>
                            <span class="text-white price-tag price-formatted-kg">{{pemancingan['biaya_olah']}}</span>
                        </div>
                    </div>
                </div>
                <a href="{{url_for('views.detail_pemancingan', id=pemancingan['id'])}}" class="btn me-3 ms-3 mb-3 theme-button-neutral-custom"><b>Detail</b></a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}

{% block page_specified_script %}
<script>

    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            // context dalam hal ini adalah fungsi yang memanggil debounce
            const context = this;

            // jika timer sudah ada, hapus timer
            clearTimeout(timeout);

            // lakukan fungsi yang dikirim setelah timer habis
            timeout = setTimeout(() => func.apply(context, args), wait);
        };
    }

    $(document).ready(function() {
        $('#cariPemancingan').on('input', debounce(function() {

            const query = $(this).val().toLowerCase();
            $.ajax({
                url: "{{ url_for('api.list_pemancingan') }}",
                method: "GET",
                data: { keyword: query },
                success: function(response) {
                    const listPemancingan = $('#list-pemancingan');
                    listPemancingan.empty();

                    console.log(response.data);

                    if (response == null || response.data == null) {
                        listPemancingan.append(`
                            <div class="d-flex flex-column justify-content-center align-items-center" style="height: 60vh;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="163" height="163" fill="#C72020" viewBox="0 0 256 256">
                                    <path d="M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,176H48V48H208V208ZM165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32Z"></path>
                                </svg>
                                <div class="container text-center page-title"><b>Pemancingan Tidak Ditemukan</b></div>
                            </div>
                        `);
                        return;
                    }

                    // membuat container row
                    const rowContainer = $('<div class="row row-cols-1 row-cols-md-12 row-cols-lg-3 g-4"></div>');

                    response.data.forEach(result_pemancingan => {

                        let biaya_tempat = ''
                        if (result_pemancingan.biaya_tempat != null) {
                            biaya_tempat = `
                                <div class="col-4 col-md-4 d-flex align-items-center">
                                    <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M232,224H208V32h8a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16h8V224H24a8,8,0,0,0,0,16H232a8,8,0,0,0,0-16ZM64,32H192V224H160V184a8,8,0,0,0-8-8H104a8,8,0,0,0-8,8v40H64Zm80,192H112V192h32ZM88,64a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H96A8,8,0,0,1,88,64Zm48,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H144A8,8,0,0,1,136,64ZM88,104a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H96A8,8,0,0,1,88,104Zm48,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H144A8,8,0,0,1,136,104ZM88,144a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H96A8,8,0,0,1,88,144Zm48,0a8,8,0,0,1,8-8h16a8,8,0,0,1,0,16H144A8,8,0,0,1,136,144Z"></path></svg>
                                    <span class="text-white price-tag price-formatted">${formatRupiah(result_pemancingan.biaya_tempat, 'Rp. ', "/Kg")}</span>
                                </div>
                            `
                        }

                        const card = `
                            <div class="col">
                                <div class="card h-100 shadow pemancingan-card">
                                    <img src="{{ url_for('static', filename='images/') }}${result_pemancingan.image_url}" class="card-img-top pemancingan-card-img" alt="...">
                                    <div class="card-body">
                                        <div class="row w-100">
                                            <div class="text-white pemancingan-card-title"><b>${result_pemancingan.nama}</b></div>
                                            <div class="text-white pemancingan-card-text mt-1 mb-2">${result_pemancingan.alamat}</div>

                                            ${biaya_tempat}
                                        
                                            <div class="col-4 col-md-4 d-flex align-items-center">
                                                <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M168,76a12,12,0,1,1-12-12A12,12,0,0,1,168,76Zm48.72,67.64c-19.37,34.9-55.44,53.76-107.24,56.1l-22,51.41A8,8,0,0,1,80.1,256l-.51,0a8,8,0,0,1-7.19-5.78L57.6,198.39,5.8,183.56a8,8,0,0,1-1-15.05l51.41-22c2.35-51.78,21.21-87.84,56.09-107.22,24.75-13.74,52.74-15.84,71.88-15.18,18.64.64,36,4.27,38.86,6a8,8,0,0,1,2.83,2.83c1.69,2.85,5.33,20.21,6,38.85C232.55,90.89,230.46,118.89,216.72,143.64Zm-55.18,29a52.11,52.11,0,0,1-33.4-44.78A52.09,52.09,0,0,1,83.37,94.47q-10.45,23.79-11.3,57.59a8,8,0,0,1-4.85,7.17L31.83,174.37l34.45,9.86a8,8,0,0,1,5.49,5.5l9.84,34.44,15.16-35.4a8,8,0,0,1,7.17-4.84Q137.71,183.12,161.54,172.64ZM212.42,43.57c-14.15-3-64.1-11-100.3,14.75a81.21,81.21,0,0,0-16,15.07,36,36,0,0,0,39.35,38.44,8,8,0,0,1,8.73,8.73,36,36,0,0,0,38.47,39.34,80.81,80.81,0,0,0,15-16C223.42,107.73,215.42,57.74,212.42,43.57Z"></path></svg>
                                                <span class="text-white price-tag price-formatted-kg">${formatRupiah(result_pemancingan.biaya_ikan, 'Rp. ', "/Kg")}</span>
                                            </div>

                                            <div class="col-4 col-md-4 d-flex align-items-center">
                                                <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#FFFFFF" viewBox="0 0 256 256"><path d="M231.87,32.13a27.84,27.84,0,0,0-39.32,0L18.34,206.4a8,8,0,0,0,3.86,13.45A160.67,160.67,0,0,0,58.4,224c32.95,0,65.92-10.2,96.95-30.23,31.76-20.5,50.19-43.82,51-44.81a8,8,0,0,0-.64-10.59L185.32,118l46.55-46.56A27.85,27.85,0,0,0,231.87,32.13ZM189.1,144.44a220.41,220.41,0,0,1-42.86,36.16c-34.43,22.1-69.94,30.92-105.77,26.3L146,101.33Zm31.46-84.3L174,106.7,157.32,90l46.55-46.56a11.8,11.8,0,0,1,16.69,16.69Z"></path></svg>
                                                <span class="text-white price-tag price-formatted-kg">${formatRupiah(result_pemancingan.biaya_olah, 'Rp. ', "/Kg")}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <a href="{{ url_for('views.detail_pemancingan', id=0) }}${result_pemancingan.id}"" class="btn me-3 ms-3 mb-3 theme-button-neutral-custom"><b>Detail</b></a>
                                </div>
                            </div>
                        `;
                        rowContainer.append(card);
                    });
                    
                    listPemancingan.append(rowContainer);
                }
            });
        }, 500));
    });
</script>
{% endblock %}